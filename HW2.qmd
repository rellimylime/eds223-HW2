---
title: "Homework Assignment #2: Exploring patterns of environmental justice:"
format: html
editor: source
editor_options: 
  chunk_output_type: inline
---
## Load necessary libraries and data
```{r}
library(sf)
library(tmap)
library(tidyverse)
library(spData)

ejscreen <- sf::st_read(here::here("data", "ejscreen","EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb")) 

birds <- sf::st_read(here::here("data", "gbif-birds-LA","gbif-birds-LA.shp")) 

ineq <- sf::st_read(here::here("data", "mapping-inequality", "mapping-inequality-los-angeles.json"))
```

## Check data CRS
```{r}
st_crs(ejscreen)
```

```{r}
st_crs(birds)
```

```{r}
st_crs(ineq)
```
We can see that the ejscreen data is in EPSG:3857, the common projected coordinate system, whereas the other two are in EPSG:4326 which is the common geodetic coordinate system. We can transform the other files' crs to match the ejscreen crs.

```{r}
birds <- st_transform(birds, crs = st_crs(ejscreen))

ineq <- st_transform(ineq, crs = st_crs(ejscreen))
```

```{r}
# Check
st_crs(ineq) == st_crs(birds)
```

```{r}
st_crs(ejscreen) == st_crs(ineq)
```
## Part 1: Legacy of redlining in current environmental (in)justice

1. Create map of historical redlining neighborhoods, including:
- neighborhoods colored by HOLC grade
- an appropriate base map
- a clear title and legend

```{r}
# filter to a state you are interested in
california <- ejscreen %>%
  dplyr::filter(ST_ABBREV == "CA") 

# filter to a county you are interested in
la_county <- ejscreen %>%
  dplyr::filter(CNTY_NAME %in% c("Los Angeles County"))

tm_shape(la_county, bbox = ineq) +
  tm_borders(lwd = 0.2) +
tm_shape(california, bbox = ineq) +
  tm_polygons(fill = "lightblue", alpha = 0.5) +
tm_shape(ineq) +
  tm_polygons(fill = "grade", title = "HOLC Grades") +
tm_legend(title = "Home Owners' Load Corporation #(HOLC)\n Historical Redlining Neighborhoods")
```
2. Create a table summarizing:
- the percentage of census block groups that fall within each HOLC grade
- Also include the percent of census block groups that dont fall within a HOLC grade
_ **Hint:** The HOLC data contains the grades and the EJScreen data contains the census blocks, so you will need to combine the data spatially before doing summary statistics. Once you combine and no longer need the geometries, you can use st_drop_geometry(). 

```{r}
block_grades <- st_join(ineq, la_county, join = st_intersects)

block_grades_df <- st_drop_geometry(block_grades)
```

```{r}
grade_summary <- block_grades_df %>% 
  group_by(grade) %>% 
  summarize(total_blocks = n()) %>% 
  mutate(percent = total_blocks / nrow(block_grades_df))
         
sum(grade_summary$percent)
```

3. Create at least two visualizations summarizing current conditions (from the EJScreen data) within HOLC grades using the mean of the following variables (you may combine variables or create separate plots):
- % low income
- percentile for Particulate Matter 2.5
- percentile for low life expectancy
- Use ggplot for your visualizations! You will first need to calculate mean of each variable grouped by HOLC grade.
```{r}
# Save data summary containing the means of each value by HOLC Grade
grade_summary_plot <- block_grades_df %>% 
  group_by(grade) %>% 
  summarize(total_blocks = n(),
            percent = total_blocks / nrow(block_grades_df),
            mean_lowincome = mean(LOWINCPCT * 100),
            mean_part = mean(P_PM25),
            mean_lifeexp = mean(P_LIFEEXPPCT, na.rm = TRUE))

# Select only the data that has a HOLC grade
grade_summary_plot_graded <- grade_summary_plot[-5,]
```

```{r}
ggplot(grade_summary_plot_graded, aes(x = mean_lowincome, y = mean_part, color = grade)) +
  geom_point(size = 3) +
  labs(x =  "% Low Income", y = "Mean Percentile for\n Particulate Matter", color = "HOLC Grade")
```

```{r}
ggplot(grade_summary_plot_graded, aes(x = mean_lowincome, y = mean_lifeexp, color = grade)) +
  geom_point(size = 3) +
  labs(x = "% Low Income", y = "Mean Percentile for\n Low Life Expectancy", color = "HOLC Grade")
  
```


4. Write a brief paragraph reflecting on these results
- Interpret the patterns you observe in your results
- Discuss potential relationships between historical redlining grades and current environmental/socioeconomic conditions


These visualizations reveal a clear connection between historical HOLC grades and current environmental and socioeconomic conditions in Los Angeles County. Neighborhoods with lower HOLC grades (C and D) consistently show higher percentages of low-income residents and worse environmental health indicators. Grade D neighborhoods, which were historically redlined, have the highest rates of low-income residents at approximately 40%, compared to only 15% in Grade A neighborhoods. Similar disparities exist for environmental health measures: Grade D neighborhoods face higher exposure to particulate matter (80th percentile) and lower life expectancy (54th percentile), while Grade A neighborhoods experience better conditions with PM2.5 at the 72nd percentile and low life expectancy at only the 24th percentile. These patterns demonstrate how discriminatory housing policies from nearly 90 years ago continue to shape present-day environmental injustices, with historically redlined communities still bearing disproportionate burdens of poverty, pollution, and reduced life expectancy.


